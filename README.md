# kotlin-bip

[![GitHub release](https://img.shields.io/badge/release-v0.0.1-blue.svg)](https://github.com/KryptonReborn/kotlin-bip/releases/tag/v0.0.1) [![Kotlin Version](https://img.shields.io/badge/Kotlin-1.9.23-B125EA?logo=kotlin)](https://kotlinlang.org)
[![Build Status](https://github.com/saschpe/kase64/workflows/Main/badge.svg)](https://github.com/KryptonReborn/kotlin-bip/actions)
[![License](http://img.shields.io/:License-Apache-blue.svg)](http://www.apache.org/licenses/LICENSE-2.0.html)

![badge-android](http://img.shields.io/badge/Platform-Android-brightgreen.svg?logo=android)
![badge-ios](http://img.shields.io/badge/Platform-iOS-orange.svg?logo=apple)
![badge-js](http://img.shields.io/badge/Platform-NodeJS-yellow.svg?logo=javascript)
![badge-jvm](http://img.shields.io/badge/Platform-JVM-red.svg?logo=openjdk)
![badge-linux](http://img.shields.io/badge/Platform-Linux-lightgrey.svg?logo=linux)
![badge-macos](http://img.shields.io/badge/Platform-macOS-orange.svg?logo=apple)
![badge-windows](http://img.shields.io/badge/Platform-Windows-blue.svg?logo=windows)

[//]: # (![badge-tvos]&#40;http://img.shields.io/badge/Platform-tvOS-orange.svg?logo=apple&#41;)

[//]: # (![badge-watchos]&#40;http://img.shields.io/badge/Platform-watchOS-orange.svg?logo=apple&#41;)

## Introduction

A concise implementation
of [BIP-0039](https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki) in Kotlin for
Multiplatform.

## Download

You must use a personal access token (classic) with the appropriate scopes to publish and install
packages
in [GitHub Packages](https://docs.github.com/en/packages/learn-github-packages/introduction-to-github-packages#authenticating-to-github-packages).

Add the following repository to your settings.gradle.kts file

```kotlin
repositories {
    maven {
        url = uri("https://maven.pkg.github.com/KryptonReborn/kotlin-bip")
        credentials {
            username = "user name"
            password = "personal access token"
        }
    }
}
```

Add the following dependency to your build.gradle.kts file

```build.gradle.kts
dependencies {
    implementation("dev.kryptonreborn.bip:[artifact]:[version]")
}
```

## Usage

This library prefers `CharArrays` over `Strings`
for [added security](https://stackoverflow.com/a/8881376/178433).  
Note: If strings or lists are desired, it is very easy (but not recommended) to convert to/from a
CharArray via `String(charArray)` or `String(charArray).split(' ')`.

* Create new 24-word mnemonic phrase

```kotlin
import dev.kryptonreborn.bip.bip39.Mnemonic

val mnemonic: Mnemonic = Mnemonic(WordCount.COUNT_24)

// assert: mnemonic.wordCount == 24, mnemonic.languageCode == "en"
```

* Generate seed

```kotlin
val seed: ByteArray = mnemonic.toSeed()
```

* Generate seed from existing mnemonic

```kotlin
val preExistingPhraseString =
    "scheme spot photo card baby mountain device kick cradle pact join borrow"
val preExistingPhraseChars = validPhraseString.toCharArray()

// from CharArray
seed = Mnemonic(preExistingPhraseChars).toSeed()

// from String
seed = Mnemonic(preExistingPhraseString).toSeed()
```

* Generate seed with passphrase

```kotlin
// normal way
val passphrase = "bitcoin".toCharArray()
mnemonic.toSeed(passphrase)

// more private way (erase at the end)
charArrayOf('z', 'c', 'a', 's', 'h').let { passphrase ->
    mnemonic.toSeed(passphrase)
    passphrase.fill('0') // erased!
}
```

* Generate raw entropy for a corresponding word count

```kotlin
val entropy: ByteArray = WordCount.COUNT_18.toEntropy()

// this can be used to directly generate a mnemonic:
val mnemonic = Mnemonic(entropy)

// note: that gives the same result as calling:
Mnemonic(WordCount.COUNT_18)
```

* Validate pre-existing or user-provided mnemonic  
  (NOTE: mnemonics generated by the library "from scratch" are valid, by definition)

```kotlin
// throws a typed exception when invalid:
//     ChecksumException - when checksum fails, usually meaning words are swapped
//     WordCountException(count) - invalid number of words
//     InvalidWordException(word) - contains a word not found on the list
mnemonic.validate()
```

* Iterate over words

```kotlin
// mnemonics are iterable
for (word in mnemonic) {
    println(word)
}

mnemonic.forEach { word ->
    println(word)
}
```

* Clean up!

```kotlin
mnemonic.clear() // code words are deleted and no longer available for attacker
```

#### Advanced Usage

These generated codes are compatible with
kotlin's [scoped resource usage](https://kotlinlang.org/docs/tutorials/kotlin-for-py/scoped-resource-usage.html)

* Leverage `use` to automatically clean-up after use

```kotlin
Mnemonic(WordCount.COUNT_24).use {
    // Do something with the words (wordCount == 24)
}
// memory has been cleared at this point (wordCount == 0)
```

* Generate original entropy that was used to create the mnemonic
  (or throw exception if the mnemonic is invalid).
    * Note: Calling this function only succeeds when the entropy is valid so it also can be used,
      indirectly, for validation. In fact, currently, it is called as part of
      the `Mnemonic::validate()` function.

```kotlin
val entropy: ByteArray = Mnemonic(preExistingPhraseString).toEntropy()
```

* Mnemonics generated by the library do not need to be validated while creating the corresponding
  seed. That step can be skipped for a little added speed and security (because validation generates
  strings on the heap--which might get improved in a future release).

```kotlin
seed = Mnemonic(WordCount.COUNT_24).toSeed(validate = false)
```

* Other languages are not yet supported but the API for them is in place. It accepts any `ISO 639-1`
  language code. For now, using it with anything other than "en" will result in
  an `UnsupportedOperationException`.

```kotlin
// results in exception, for now
val mnemonic = Mnemonic(WordCount.COUNT_24, languageCode = Locale.GERMAN.language)

// english is the only language that doesn't crash
val mnemonic = Mnemonic(WordCount.COUNT_24, languageCode = Locale.ENGLISH.language)
```

## Acknowledgements
[bip39](https://github.com/KryptonReborn/kotlin-bip/tree/main/bip39) is inspired by [kotlin-bip39](https://github.com/Electric-Coin-Company/kotlin-bip39/tree/main/bip39-lib/src/commonMain/kotlin/cash/z/ecc/android/bip39) by [Electric Coin Company](https://github.com/Electric-Coin-Company)

[bip44](https://github.com/KryptonReborn/kotlin-bip/tree/main/bip44) is inspired by [hdwallet](https://github.com/FigureTechnologies/hdwallet/tree/main/bip44) by [Figure Technologies Inc.](https://github.com/FigureTechnologies)
